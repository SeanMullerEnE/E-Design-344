Version 4
SHEET 1 1824 2192
WIRE -2016 -1072 -2080 -1072
WIRE -1680 -1072 -1936 -1072
WIRE -2080 -1056 -2080 -1072
WIRE 48 -976 16 -976
WIRE 160 -976 128 -976
WIRE -2080 -960 -2080 -976
WIRE -1120 -944 -1168 -944
WIRE -1008 -944 -1040 -944
WIRE -1680 -896 -2080 -896
WIRE -608 -880 -608 -928
WIRE -448 -880 -608 -880
WIRE -1680 -864 -1952 -864
WIRE -1120 -848 -1168 -848
WIRE -1008 -848 -1008 -944
WIRE -1008 -848 -1040 -848
WIRE -832 -848 -1008 -848
WIRE -544 -848 -752 -848
WIRE -384 -848 -512 -848
WIRE -1680 -832 -1840 -832
WIRE -448 -816 -448 -880
WIRE -1680 -800 -1728 -800
WIRE -608 -800 -608 -880
WIRE -512 -800 -512 -848
WIRE -480 -800 -512 -800
WIRE 80 -800 80 -816
WIRE -2080 -784 -2080 -896
WIRE -1952 -784 -1952 -864
WIRE -1840 -784 -1840 -832
WIRE -1728 -784 -1728 -800
WIRE -1008 -784 -1008 -848
WIRE -640 -784 -1008 -784
WIRE -384 -784 -384 -848
WIRE -384 -784 -416 -784
WIRE -80 -784 -384 -784
WIRE 16 -784 16 -976
WIRE 16 -784 0 -784
WIRE 48 -784 16 -784
WIRE -544 -768 -544 -848
WIRE -544 -768 -576 -768
WIRE -480 -768 -544 -768
WIRE 160 -768 160 -976
WIRE 160 -768 112 -768
WIRE 288 -768 160 -768
WIRE -640 -752 -672 -752
WIRE 48 -752 16 -752
WIRE -1120 -736 -1168 -736
WIRE -1008 -736 -1008 -784
WIRE -1008 -736 -1040 -736
WIRE -864 -736 -880 -736
WIRE -672 -736 -672 -752
WIRE -672 -736 -784 -736
WIRE -448 -736 -448 -752
WIRE -1952 -704 -2080 -704
WIRE -1840 -704 -1952 -704
WIRE -1728 -704 -1840 -704
WIRE -1680 -704 -1728 -704
WIRE -1680 -688 -1680 -704
WIRE -80 -688 -240 -688
WIRE 16 -688 16 -752
WIRE 16 -688 0 -688
WIRE 48 -688 16 -688
WIRE -672 -672 -672 -736
WIRE -1120 -640 -1168 -640
WIRE -1008 -640 -1008 -736
WIRE -1008 -640 -1040 -640
WIRE 48 -640 48 -688
WIRE -672 -560 -672 -592
WIRE -608 -560 -608 -736
WIRE -608 -560 -672 -560
WIRE -608 -544 -608 -560
WIRE 48 -544 48 -560
WIRE 80 -544 80 -736
WIRE 80 -544 48 -544
WIRE 48 -528 48 -544
WIRE -240 -432 -240 -688
WIRE 384 -432 -240 -432
WIRE -1856 -352 -1952 -352
WIRE 288 -272 272 -272
WIRE -48 -256 -64 -256
WIRE -96 -224 -160 -224
WIRE 48 -224 -96 -224
WIRE -560 -192 -608 -192
WIRE -448 -192 -496 -192
WIRE -256 -192 -448 -192
WIRE 384 -176 384 -432
WIRE 384 -176 240 -176
WIRE 288 -144 288 -272
WIRE -1888 -128 -1952 -128
WIRE -1792 -128 -1808 -128
WIRE -48 -128 -48 -256
WIRE 240 -128 240 -176
WIRE 256 -128 240 -128
WIRE -1952 -112 -1952 -128
WIRE -384 -112 -384 -128
WIRE -160 -112 -160 -144
WIRE -96 -112 -96 -224
WIRE -80 -112 -96 -112
WIRE 384 -112 384 -176
WIRE 384 -112 320 -112
WIRE -448 -96 -448 -192
WIRE -416 -96 -448 -96
WIRE 48 -96 48 -144
WIRE 48 -96 -16 -96
WIRE 112 -96 48 -96
WIRE 224 -96 192 -96
WIRE 256 -96 224 -96
WIRE -256 -80 -256 -192
WIRE -256 -80 -352 -80
WIRE -80 -80 -256 -80
WIRE -944 -64 -1024 -64
WIRE -784 -64 -864 -64
WIRE -736 -64 -784 -64
WIRE -608 -64 -608 -192
WIRE -608 -64 -656 -64
WIRE -560 -64 -608 -64
WIRE -448 -64 -480 -64
WIRE -416 -64 -448 -64
WIRE 224 -64 224 -96
WIRE -448 -32 -448 -64
WIRE 288 -32 288 -80
WIRE -784 -16 -784 -64
WIRE -48 -16 -48 -64
WIRE -1552 16 -1568 16
WIRE -1568 64 -1568 16
WIRE -784 64 -784 48
WIRE -528 64 -784 64
WIRE -448 64 -448 32
WIRE -448 64 -528 64
WIRE -384 64 -384 -48
WIRE -384 64 -448 64
WIRE 224 64 224 16
WIRE -528 128 -528 64
FLAG -1680 -1072 5V
IOPIN -1680 -1072 In
FLAG -2080 -960 0
FLAG -608 -928 5V
IOPIN -608 -928 In
FLAG -1680 -688 0
FLAG -1680 -896 b3
IOPIN -1680 -896 In
FLAG -1680 -864 b2
IOPIN -1680 -864 In
FLAG -1680 -832 b1
IOPIN -1680 -832 In
FLAG -1680 -800 b0
IOPIN -1680 -800 In
FLAG -1168 -640 b3
IOPIN -1168 -640 In
FLAG -1168 -736 b2
IOPIN -1168 -736 In
FLAG -1168 -848 b1
IOPIN -1168 -848 In
FLAG -1168 -944 b0
IOPIN -1168 -944 In
FLAG -1856 -352 SpeedCmd_analog
IOPIN -1856 -352 In
FLAG -1952 -272 0
FLAG -608 -544 0
FLAG -880 -736 5V
IOPIN -880 -736 In
FLAG -448 -736 0
FLAG 288 -768 motor_control
IOPIN 288 -768 In
FLAG 48 -528 0
FLAG 80 -816 Vbatt
IOPIN 80 -816 Out
FLAG -1792 -128 Vbatt
IOPIN -1792 -128 Out
FLAG -1952 -32 0
FLAG -1568 384 0
FLAG -1552 16 ultrasonic_out
IOPIN -1552 16 Out
FLAG -1024 -64 ultrasonic_out
IOPIN -1024 -64 Out
FLAG -64 -256 5V
IOPIN -64 -256 In
FLAG -160 -112 0
FLAG -528 128 0
FLAG -384 -128 5V
IOPIN -384 -128 In
FLAG -48 -16 0
FLAG 224 64 0
FLAG 272 -272 5V
IOPIN 272 -272 In
FLAG 288 -32 0
SYMBOL voltage -2080 -1072 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 5
SYMBOL res -2032 -1088 M90
WINDOW 0 -7 47 VBottom 2
WINDOW 3 29 54 VTop 2
SYMATTR InstName RSense5V
SYMATTR Value 1µ
SYMBOL voltage -1728 -800 R0
WINDOW 3 -3 125 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -65 54 Left 2
SYMATTR Value PWL file=b0PWL.csv
SYMATTR InstName V1
SYMBOL voltage -1840 -800 R0
WINDOW 3 2 124 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -66 54 Left 2
SYMATTR Value PWL file=b1PWL.csv
SYMATTR InstName V2
SYMBOL voltage -1952 -800 R0
WINDOW 3 -2 122 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -62 53 Left 2
SYMATTR Value PWL file=b2PWL.csv
SYMATTR InstName V3
SYMBOL voltage -2080 -800 R0
WINDOW 3 6 124 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -77 57 Left 2
SYMATTR Value PWL file=b3PWL.csv
SYMATTR InstName V4
SYMBOL res -1968 -368 R0
SYMATTR InstName R12
SYMATTR Value 100k
SYMBOL Opamps\\LTC6079 -608 -768 R0
SYMATTR InstName U1
SYMBOL res -1024 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value R=Rbase
SYMBOL res -1024 -752 R90
WINDOW 0 -2 54 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value R=2*Rbase
SYMBOL res -1024 -864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value R=4*Rbase
SYMBOL res -1024 -960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 36 58 VTop 2
SYMATTR InstName R4
SYMATTR Value R=8*Rbase
SYMBOL res -736 -864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rf
SYMATTR Value R=8/15*Rbase
SYMBOL res -656 -576 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R6
SYMATTR Value R= 0.4925*Roff
SYMBOL res -880 -720 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value R=Roff
SYMBOL Opamps\\LTC6079 -448 -784 R0
SYMATTR InstName U2
SYMBOL res 16 -800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value R = Rbase1
SYMBOL res 16 -704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value R= Rbase1
SYMBOL res 64 -544 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R9
SYMATTR Value R=Rbase1*gain
SYMBOL res 32 -960 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value R=Rbase1*gain
SYMBOL voltage -1952 -128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 6.5
SYMBOL res -1904 -144 M90
WINDOW 0 -7 47 VBottom 2
WINDOW 3 29 54 VTop 2
SYMATTR InstName RSenseVbatt1
SYMATTR Value 1µ
SYMBOL Opamps\\opamp2 80 -832 R0
SYMATTR InstName U3
SYMATTR Value TLC2272
SYMATTR SpiceModel TLC2272
SYMBOL voltage -1568 48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -437 49 Left 2
SYMATTR Value PULSE(0 5 0 0 0 6000u 60m 33)
SYMATTR InstName V8
SYMBOL voltage -1568 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -454 54 Left 2
SYMATTR Value PULSE(0 5 2 0 0 500u 60m 33)
SYMATTR InstName V9
SYMBOL voltage -1568 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -437 49 Left 2
SYMATTR Value PULSE(0 5 4 0 0 6000u 60m 33)
SYMATTR InstName V10
SYMBOL voltage -1568 288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -437 49 Left 2
SYMATTR Value PULSE(0 5 6 0 0 3000u 60m 33)
SYMATTR InstName V11
SYMBOL Opamps\\LTC6079 -48 -96 R0
SYMATTR InstName U4
SYMBOL res 64 -128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value 175k
SYMBOL res -144 -128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R13
SYMATTR Value 22k
SYMBOL Opamps\\LTC6079 -384 -80 R0
SYMATTR InstName U5
SYMBOL res -848 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 120k
SYMBOL res -640 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 180k
SYMBOL res -464 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 565k
SYMBOL cap -800 -16 R0
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL cap -464 -32 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL cap -496 -208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 470n
SYMBOL res 208 -112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 34k
SYMBOL res 240 32 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R18
SYMATTR Value 66k
SYMBOL Opamps\\LTC6079 816 0 R0
SYMATTR InstName U6
SYMBOL Opamps\\LTC6079 496 -320 R0
SYMATTR InstName U8
SYMBOL Opamps\\opamp2 288 -176 R0
SYMATTR InstName U7
SYMATTR Value TLC2272
SYMATTR SpiceModel TLC2272
TEXT -2288 -1384 Left 2 ;Don't change these -- used for auto-assessments.\nYou may modify the input files (.txt and .csv) \n               while developing.\nFor submission: \n  * Only one label name per net name\n  * Use only 5V for power
TEXT -1552 -1400 Left 2 ;=============================\nREPLACE WITH YOUR DETAILS\nS. Muller.,  23575786\n=============================
TEXT -960 -1400 Left 2 ;=============================\nIncludes (don't fiddle with this!!)\n=============================
TEXT -1272 -1160 Left 2 ;=======================================\nYour circuit goes here, these are just placeholders.\n=======================================
TEXT -1392 -1448 Left 2 ;PLEASE WAIT FOR YOUR SIMULATION TO FINISH BEFORE SUBMITTING.
TEXT -2320 -1136 Left 2 !.tran 0 {transtop} 0
TEXT -2320 -1168 Left 2 !.include A3cfg.txt
TEXT -2312 -1032 Left 2 ;5V supply
TEXT -2352 -912 Left 2 ;4-bit 3.3V\ntorque command\n(input to your circuit)
TEXT -2344 -336 Left 2 ;Analogue speed command\n(output from your circuit)
TEXT -1112 -392 Left 2 !.param Rbase = 50k
TEXT -1104 -360 Left 2 !.param Roff = 100k
TEXT 168 -632 Left 2 !.param Rbase1 = 50k
TEXT 168 -664 Left 2 !.param gain = 6.5/2.5
TEXT -944 -1312 Left 2 !.inc TLC2272.lib
LINE Normal -1584 -1424 -1584 -240 2
LINE Normal -2368 -1424 -1584 -1424 2
LINE Normal -1584 -240 -2368 -240 2
LINE Normal -1584 -256 -1584 -256 2
LINE Normal -2368 -1424 -2368 -240 2
